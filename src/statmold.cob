IDENTIFICATION DIVISION.
PROGRAM-ID. STATMOLD.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO DYNAMIC WS-FILENAME
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD INPUT-FILE.
   01 INPUT-LINE         PIC X(80).

WORKING-STORAGE SECTION. 
01 WS-FILENAME           PIC X(100).
01 WS-COUNTERS.
   05 WS-N               PIC S9(4) VALUE ZERO.
   05 WS-I               PIC S9(4) VALUE ZERO.
01 WS-FLAGS.
   05 WS-END-FLAG        PIC 9 VALUE 0.
      88 WS-END-OF-FILE  VALUE 1.
01 WS-STATS.
   05 WS-SUM-OF-X-SQR    PIC 9(14)V9(2) VALUE ZERO.
   05 WS-SUM-OF-X        PIC S9(10)V9(2) VALUE ZERO.
   05 WS-MEAN            PIC S9(6)V9(2) VALUE ZERO.
   05 WS-STD-DEV         PIC S9(6)V9(2) VALUE ZERO.
01 WS-TEMP-VALUES.
   05 WS-CURRENT-VALUE   PIC S9(6)V9(2) VALUE ZERO.
   05 WS-DISPLAY-VALUE   PIC S9(6)V9(2) VALUE ZERO.
   05 WS-ARRAY-VALUE     PIC S9(6)V9(2) VALUE ZERO.
01 WS-DATA-ARRAY.
   05 WS-X               PIC S9(6)V9(2) OCCURS 1000 TIMES.
01 WS-OUTPUT-FORMATS.
   05 WS-OUTPUT-TITLE-LINE.
      10 FILLER          PIC X(28) VALUE " MEAN AND STANDARD DEVIATION".
   05 WS-OUTPUT-UNDERLINE.
      10 FILLER          PIC X(28) VALUE "----------------------------".
   05 WS-OUTPUT-COL-HEADS.
      10 FILLER          PIC X(10) VALUE SPACES.
      10 FILLER          PIC X(11) VALUE "DATA VALUES".
   05 WS-OUTPUT-DATA-LINE.
      10 FILLER          PIC X(10) VALUE SPACES.
      10 WS-OUT-X        PIC -(6)9.9(2).
   05 WS-OUTPUT-RESULTS-LINE-1.
      10 FILLER          PIC X(9) VALUE " MEAN=   ".
      10 WS-OUT-MEAN     PIC -(6)9.9(2).
   05 WS-OUTPUT-RESULTS-LINE-2.
      10 FILLER          PIC X(9) VALUE " STD DEV=".
      10 WS-OUT-STD-DEV  PIC -(6)9.9(2).

PROCEDURE DIVISION.
0000-MAIN.
    DISPLAY "STATISTICAL CALCULATION PROGRAM".
    DISPLAY "==============================".
    DISPLAY "Enter the input file name: " WITH NO ADVANCING.
    ACCEPT WS-FILENAME.
    
    OPEN INPUT INPUT-FILE.
    IF RETURN-CODE NOT = 0
        DISPLAY "Error opening file: " WS-FILENAME
        STOP RUN
    END-IF.
    
    PERFORM 1000-PROCESS-DATA.
    PERFORM 9000-CLEANUP.
    STOP RUN.

1000-PROCESS-DATA.
    PERFORM 1100-DISPLAY-HEADERS.
    PERFORM 1200-READ-AND-PROCESS-DATA.
    PERFORM 1300-COMPUTE-AND-DISPLAY-RESULTS.

1100-DISPLAY-HEADERS.
    DISPLAY WS-OUTPUT-TITLE-LINE.
    DISPLAY WS-OUTPUT-UNDERLINE.
    DISPLAY WS-OUTPUT-COL-HEADS.
    DISPLAY WS-OUTPUT-UNDERLINE.

1200-READ-AND-PROCESS-DATA.
    MOVE ZERO TO WS-N.
    MOVE ZERO TO WS-SUM-OF-X.
    MOVE ZERO TO WS-END-FLAG.

    PERFORM UNTIL WS-END-OF-FILE OR WS-N >= 1000
       READ INPUT-FILE INTO INPUT-LINE
          AT END
             SET WS-END-OF-FILE TO TRUE
          NOT AT END
             COMPUTE WS-CURRENT-VALUE = FUNCTION NUMVAL(INPUT-LINE)
             ON SIZE ERROR
                DISPLAY "Error converting value: " INPUT-LINE
                CONTINUE
             END-COMPUTE
             
             ADD 1 TO WS-N
             
             MOVE WS-CURRENT-VALUE TO WS-X(WS-N)
             
             MOVE WS-CURRENT-VALUE TO WS-OUT-X
             DISPLAY WS-OUTPUT-DATA-LINE
             
             ADD WS-CURRENT-VALUE TO WS-SUM-OF-X
       END-READ
    END-PERFORM.

1300-COMPUTE-AND-DISPLAY-RESULTS.
    IF WS-N > 0
       DIVIDE WS-N INTO WS-SUM-OF-X GIVING WS-MEAN ROUNDED
       MOVE ZERO TO WS-SUM-OF-X-SQR
       PERFORM VARYING WS-I FROM 1 BY 1 UNTIL WS-I > WS-N
          COMPUTE WS-SUM-OF-X-SQR = WS-SUM-OF-X-SQR + 
                 (WS-X(WS-I) - WS-MEAN) ** 2
       END-PERFORM
       COMPUTE WS-STD-DEV ROUNDED = (WS-SUM-OF-X-SQR / WS-N) ** 0.5
       
       DISPLAY WS-OUTPUT-UNDERLINE
       MOVE WS-MEAN TO WS-OUT-MEAN
       DISPLAY WS-OUTPUT-RESULTS-LINE-1
       MOVE WS-STD-DEV TO WS-OUT-STD-DEV
       DISPLAY WS-OUTPUT-RESULTS-LINE-2
    ELSE
       DISPLAY "No data was processed."
    END-IF.

9000-CLEANUP.
    CLOSE INPUT-FILE. 

